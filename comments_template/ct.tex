% OWD 2023
%
% NOTE: You will need to pass -shell-escape to latexmk (or any equivalent build
% system) to compile this document.  This is a requirement of the 'minted'
% package, which is used for source code formatting (syntax highlighting, line
% numbering, et cetera).

\documentclass{article}
\usepackage[a4paper]{geometry}
\usepackage{fancyhdr,lastpage,xcolor,lineno,titlesec,minted,xstring}
\usepackage[%
	colorlinks = true,
	allcolors = darkgray,
        linktoc = page
]{hyperref}

% Per-document variables. You will want to change these.
%
% - \author: your name, and your York IT Services username.
%       Example: "Oliver Dixon", and "od641".
%
% - \originalauthor: as with \author, but for the subject of your comments.
%       Example: "Matthew Drury", and "md1499".
%
% - \commithashlong: the git commit hash that is most germane to your comments.
%       You can find this by using the `git tree` command, or going on the GitHub
%       website and reviewing the commit log.
%
%       Example: 1fdca05a3331dedea459ce802fe15c81230e967b
%
% - \originaltexfile: the location of the subject .tex document on your file
%       system. This can be a relative or absolute path, but it must be valid
%       TeX with no preamble-only commands.
%
%       Example: ./matthew.tex
%
\author{Print Name \textless\yorkemail{user}\textgreater}
\newcommand{\originalauthor}{Print Name \textless\yorkemail{user}\textgreater}
\newcommand{\commithashlong}{commithash}
\newcommand{\originaltexfile}{./file.tex}

% Formatting the original text and source thereof. Minted is used for verbatim
% environments with LaTeX syntax highlighting.
%
\renewcommand{\linenumberfont}{\normalfont\small}
\setlength\linenumbersep{2em}
\renewcommand{\theFancyVerbLine}{\linenumberfont\arabic{FancyVerbLine}}

\setminted[latex]{%
        linenos,
        breaklines,
        frame=single,
        xleftmargin=-.8em
}

\newcommand{\printoriginal}{%
        \clearpage
        \section*{Original Copy (Rendered)}
        \begin{linenumbers}
                \input{\originaltexfile}
        \end{linenumbers}
        \section*{Original Copy (Source)}
        \inputminted{latex}{\originaltexfile}
}


% Document metadata set-up.
%
\title{MS1 GP Comments Track}
\DeclareRobustCommand{\commithashshort}{%
        \StrLeft{\commithashlong}{7}[\strtmp]%
        \commitref{\strtmp}
}

% Header and footer configuration.
%
\fancypagestyle{title}{%
        \thispagestyle{fancy}
        \fancyhead[L]{}
}
\makeatletter
\fancypagestyle{fancy}{%
        \fancyhf{}
	\fancyhead[R]{\@author}
        \fancyhead[L]{\@title\ @ \commithashshort}
        \fancyfoot[L]{\today}
        \fancyfoot[R]{Page \thepage{} of~\pageref{LastPage}}
}
\makeatother
\renewcommand{\headrulewidth}{.5pt}
\renewcommand{\footrulewidth}{\headrulewidth}

% Miscellaneous formatting commands.
%
\renewcommand{\labelitemi}{$\vcenter{\hbox{\tiny$\bullet$}}$}
\newcommand{\yorkemail}[1]{\href{mailto:#1@york.ac.uk}{#1@york.ac.uk}}
\newcommand{\commitref}[1]{\href{https://github.com/oliverdixon/MS1GP/%
        commit/\commithashlong}{\texttt{#1}}}
\titleformat*{\section}{\centering \bfseries\LARGE}
\makeatletter
\newcommand{\subtitle}{%
        \vspace{-.3\baselineskip}
        \begin{center}
                Commit Hash: \commitref{\commithashlong}
                \vspace{.3\baselineskip}

                Comments Author: \@author

                Original Text Author: \originalauthor
        \end{center}
        \vspace{2\baselineskip}
        \par\vspace{-2em}\noindent\rule{\textwidth}{\headrulewidth}\vspace{1em}
}
\makeatother

% End of the preamble; start of the document.
%
\begin{document}
\thispagestyle{title}
\pagestyle{fancy}
\makeatletter
\section*{\@title}
\makeatother
\subtitle
\begin{itemize}
        \item Write your comments here.
\end{itemize}
% \printoriginal <-- TODO: Uncomment this.
\end{document}

